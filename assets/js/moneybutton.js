/**
 * Copyright 2019 Yours Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is furnished
 * to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */var moneyButton=function(a){'use strict';function b(a){switch(a.arrayFormat){case"index":return(b,d,e)=>null===d?[c(b,a),"[",e,"]"].join(""):[c(b,a),"[",c(e,a),"]=",c(d,a)].join("");case"bracket":return(b,d)=>null===d?[c(b,a),"[]"].join(""):[c(b,a),"[]=",c(d,a)].join("");default:return(b,d)=>null===d?c(b,a):[c(b,a),"=",c(d,a)].join("");}}function c(a,b){return b.encode?b.strict?u(a):encodeURIComponent(a):a}function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function e(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function f(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?e(b,!0).forEach(function(c){d(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):e(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function g(){return Math.floor(1e17*Math.random()).toString()}function h(){C&&(C.parentNode.removeChild(C),C=null)}function i({title:a,message:b,buttonText:c,buttonUrl:d,buttonText2:e,buttonUrl2:f}){h(),C=document.createElement("div"),C.setAttribute("style","display: flex; justify-content: center; font-family: sans-serif;");let g=document.getElementsByClassName("popup__moneybutton").item(0);null===g&&(g=s(),document.body.appendChild(g)),g.appendChild(C),C.innerHTML="\n    <div class=\"close__moneybutton\"></div>\n    <div class=\"hint__moneybutton\">\n      <div class=\"content__moneybutton\">\n        <span class=\"title__moneybutton\">".concat(a,"</span>\n        <span class=\"text__moneybutton\">").concat(b,"</span>\n        <div class=\"buttonsWrapper__moneybutton\">\n          ").concat(c?"<a href=\"".concat(d,"\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"button__moneybutton red__moneybutton\">").concat(c,"</a>"):"","\n          ").concat(e?"<a href=\"".concat(f,"\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"button__moneybutton nofill__moneybutton\">").concat(e,"</a>"):"","\n        </div>\n      </div>\n      <style>\n        .hint__moneybutton .button__moneybutton,\n        .hint__moneybutton .title__moneybutton{\n          font-weight:700\n        }\n        .hint__moneybutton .button__moneybutton,\n        .hint__moneybutton .content__moneybutton{\n            color:#fff;\n            box-sizing:border-box;\n            display:flex;\n            font-family: 'IBM Plex Sans', sans-serif;\n        }\n        .hint__moneybutton a{\n            text-decoration:none;\n        }\n        .hint__moneybutton{\n            min-width:254px;\n            position:fixed;\n            bottom: 10px;\n            right: 10px;\n            max-width: 300px;\n            z-index: 1000;\n        }\n        .hint__moneybutton .content__moneybutton{\n          top:0;\n          left:0;\n          right:0;\n          bottom:0;\n          z-index:1\n        }\n        .hint__moneybutton .content__moneybutton{\n            background-color:#191927;\n            padding:30px;\n            border-radius:10px;\n            bottom:19px;\n            left:0;\n            right:0;\n            flex-direction:column;\n            align-content:center;\n            align-items:flex-start;\n            min-width: 260px;\n        }\n        .hint__moneybutton .title__moneybutton{\n            font-size:20px;\n            margin-bottom:10px\n        }\n        .hint__moneybutton .text__moneybutton{\n            font-size:14px;\n            margin-bottom:20px\n        }\n        .hint__moneybutton .buttonsWrapper__moneybutton{\n            width:100%;\n            display:flex;\n            justify-content:space-between;\n            position:relative;\n            z-index:2\n        }\n        .hint__moneybutton .button__moneybutton{\n            text-align:center;\n            font-size:12px;\n            width:calc(50% - 10px);\n            height:35px;\n            padding:0 10px;\n            border-radius:20px;\n            align-items:center;\n            justify-content:center;\n            transition:all 250ms ease-out;\n            cursor:pointer\n        }\n        .hint__moneybutton .button__moneybutton.add__moneybutton {\n            width: auto;\n        }\n        .hint__moneybutton .button__moneybutton.red__moneybutton{\n            background-color:#e54d3f\n        }\n        .hint__moneybutton .button__moneybutton.red__moneybutton:hover{\n            background-color:#ce4134\n        }\n        .hint__moneybutton .button__moneybutton.nofill__moneybutton{\n            border:1px solid #fff\n        }\n        .hint__moneybutton .button__moneybutton.nofill__moneybutton:hover{\n            color:#191927;\n            background-color:#fff\n        }\n        .close__moneybutton {\n          background-color: rgba(255, 255, 255, 0.6);\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100vw;\n          height: 100vh;\n          z-index: 999;\n        }\n        @import url('https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,700');\n      </style>\n    </div>\n  ");const i=document.getElementsByClassName("close__moneybutton").item(0);i.addEventListener("click",h)}function j(a,b={}){D.has(a)?l(a,b):k(a,b)}function k(a,b){m(a,b);const c=o(b);a.appendChild(c),a.style.position="relative",a.style.display="inline-block",a.style.width="280px",a.style.height="50px",c.contentWindow.onunload=()=>{(null===c.contentWindow||c.contentWindow.location.href===p())&&(D.delete(a),a.innerHTML="")};const d=new z(c.contentWindow);d.send("initial-attributes",n(b),{}),d.subscribe("ready",()=>{d.enableDeliver(),b.onLoad&&"function"==typeof b.onLoad&&b.onLoad()}),d.subscribe("payment-success",a=>q(a,b)),d.subscribe("error.insufficient-balance",a=>r(a,b)),d.subscribe("error.unexpected-error",a=>r(a,b)),d.subscribe("error.not-logged-in",a=>r(a,b)),d.subscribe("error.compatibility",a=>r(a,b)),d.subscribe("error.safari-compatibility",a=>r(a,b)),d.subscribe("error.too-long-mempool-chain",a=>r(a,b)),d.subscribe("error",a=>r(a,b)),d.start(),D.set(a,d)}function l(a,b){const c=D.get(a);c.send("attributes-updated",n(b)),c.subscribe("payment-success",a=>q(a,b)),c.subscribe("error.insufficient-balance",a=>r(a,b)),c.subscribe("error.unexpected-error",a=>r(a,b)),c.subscribe("error.not-logged-in",a=>r(a,b)),c.subscribe("error.compatibility",a=>r(a,b)),c.subscribe("error.safari-compatibility",a=>r(a,b)),c.subscribe("error.too-long-mempool-chain",a=>r(a,b)),c.subscribe("error",a=>r(a,b))}function m(a,b){if(!(a instanceof Element))throw new Error("The first argument must be of type Element.");if(!(a instanceof Object)||0===Object.keys(b).length)throw new Error("Please, specify the button's attributes.");if(void 0!==b.buttonData&&"string"!=typeof b.buttonData)throw new Error("\"buttonData\" should be a string.")}function n(a){return{to:a.to,amt:a.amount,edt:a.editable,ccy:a.currency,lbl:a.label,scsmsg:a.successMessage,opd:a.opReturn,os:JSON.stringify(a.outputs),cid:a.clientIdentifier,bid:a.buttonId,bdt:a.buttonData,t:a.type,dev:a.devMode,dsbd:a.disabled}}function o(a={}){const b=document.createElement("iframe");return b.style.border="none",b.style.width="280px",b.style.height="50px",b.scrolling="no",b.src=p(),b}function p(){return"".concat(A,"/iframe/v2?").concat(v({format:"postmessage"}))}function q(a,b){const{payment:c}=a;c&&"function"==typeof b.onPayment&&b.onPayment.call(window,c)}function r(a,b){const{error:c,popup:d}=a;d&&i(d),c&&"function"==typeof b.onError&&b.onError.call(window,new Error(c))}function s(){const a=document.createElement("div");return a.className="popup__moneybutton",a.style.position="relative",a.style.display="flex",a.style.justifyContent="center",a}function t(a){const b={};for(const c in a){const d=a[c];if(!B.includes(c)){console.warn("Unexpected data attribute: ".concat(c,"."));continue}switch(c){case"outputs":let a;try{a=JSON.parse(d)}catch(b){a=null}a instanceof Array?b[c]=a:console.warn("The value provided for ".concat(c," is not a valid JSON array."));break;case"devMode":b[c]="true"===d;break;case"onPayment":case"onError":case"onLoad":"function"==typeof window[d]?b[c]=window[d]:console.warn("The value provided for ".concat(c," is not a function in the global scope."));break;default:b[c]=d;}}return b}var u=a=>encodeURIComponent(a).replace(/[!'()*]/g,a=>"%".concat(a.charCodeAt(0).toString(16).toUpperCase())),v=(a,d)=>{d=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},d),!1===d.sort&&(d.sort=()=>{});const e=b(d);return a?Object.keys(a).sort(d.sort).map(b=>{const f=a[b];if(void 0===f)return"";if(null===f)return c(b,d);if(Array.isArray(f)){const a=[];for(const c of f.slice())void 0!==c&&a.push(e(b,c,a.length));return a.join("&")}return c(b,d)+"="+c(f,d)}).filter(a=>0<a.length).join("&"):""};class w{constructor(a){this.keyDefined=b=>b in a,this.getValue=b=>a[b]}get(a){if(this.keyDefined(a))return this.getValue(a);throw new Error("Unknown configuration: ".concat(a))}}const x=new class{constructor(){this.variables={}}build(){return new w(this.variables)}addValue(a,b){if(void 0===b)throw new Error("Failed to add \"".concat(a,"\" property. The value cannot be undefined"));if(a in this.variables)throw new Error("\"".concat(a,"\" already has a value defined."));return this.variables[a]=b,this}addValueWithDefault(a,b,c){if(void 0===c)throw new Error("Failed to add \"".concat(a,"\" property. Default value cannot be undefined"));return this.addValue(a,void 0===b?c:b)}}().addValue("NETWORK","mainnet").addValue("MONEY_BUTTON_WEBAPP_PROXY_URI","https://www.moneybutton.com").build(),y=x.get("MONEY_BUTTON_WEBAPP_PROXY_URI");class z{constructor(a){d(this,"start",()=>{window.addEventListener("message",this._onMessageReceived,!1)}),d(this,"enableDeliver",()=>{this._deliverMessages=!0,this._pendingMessages.forEach(a=>this.send(a.topic,a.payload,a.extraPayload)),this._pendingMessages=[]}),d(this,"finalize",()=>{window.removeEventListener("message",this._onMessageReceived,!1)}),d(this,"subscribe",(a,b)=>{this.handlers[a]=b}),d(this,"_onMessageReceived",a=>{if(a.source!==this.targetWindow)return;if(!a.data||!a.data.v1)return;const b=a.data.v1,c=this.handlers[b.topic];c&&c(b.payload,b.topic,b.messageId)}),d(this,"send",(a,b,c={})=>{if(!this._deliverMessages)this._pendingMessages=[...this._pendingMessages,{topic:a,payload:b,extraPayload:c}];else{const d=g();this.targetWindow.postMessage(f({},{v1:{topic:a,payload:b,messageId:d}},{},c),"*")}}),d(this,"sendInsufficientBalanceError",()=>{const a={error:"insufficient balance",popup:{title:"Low Balance",message:"Your balance is too low to make this payment.",buttonText:"Add Money",buttonUrl:"".concat(y,"/money")}};this.send("error.insufficient-balance",a,a)}),d(this,"sendUnexpectedError",a=>{const b={error:"unexpected error",popup:{title:"Unexpected Error",message:a.message}};this.send("error.unexpected-error",b,b)}),d(this,"sendPaymentSuccess",a=>{const b={payment:a};this.send("payment-success",b,b)}),d(this,"sendNotLoggedInError",()=>{const a={error:"not logged in",popup:{title:"Money Button",message:"We believe in sound digital money for everyone in the world. Join Money Button to make this payment.",buttonText:"Sign Up",buttonUrl:"".concat(y,"/register"),buttonText2:"Log In",buttonUrl2:"".concat(y,"/login")}};this.send("error.not-logged-in",a,a)}),d(this,"sendCompatibilityIssue",a=>{const b={error:"compatibility",message:a.message,popup:{title:"Compatibility",message:a.message}};this.send("error.compatibility",b,b)}),d(this,"sendSafaryIssueHint",()=>{const a={error:"safari privacy",popup:{title:"Money Button",message:"We believe in sound digital money for everyone in the world. Enable Money Button on Safari and log in to make this payment.",buttonUrl:"https://blog.moneybutton.com/2018/09/24/how-to-enable-money-button-on-safari-and-ios/",buttonText:"Enable"}};this.send("error.safari-compatibility",a,a)}),this.handlers={},this.targetWindow=a,this._pendingMessages=[],this._deliverMessages=!1}}const A="https://www.moneybutton.com",B=["to","amount","currency","label","successMessage","opReturn","outputs","clientIdentifier","buttonId","buttonData","type","onPayment","onError","onLoad","devMode","editable","disabled"];let C=null;const D=new Map;return document.addEventListener("DOMContentLoaded",function(){if(!window.moneyButton.alreadyLoaded){window.moneyButton.alreadyLoaded=!0;const a=s();document.body.appendChild(a);const b=document.getElementsByClassName("money-button");for(let a=0;a<b.length;++a){const c=b.item(a);try{const a=t(c.dataset);0<Object.keys(a).length&&j(c,a),console.log("Money Button: added button.")}catch(a){console.error("Money Button: adding button failed.",a)}}}}),a.render=j,a}({});
//# sourceMappingURL=moneybutton.js.map
export default moneyButton